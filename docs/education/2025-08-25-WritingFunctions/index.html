<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Jason Everett">
<meta name="dcterms.date" content="2025-08-25">
<meta name="description" content="This tutorial will cover the basics of function structure, writing and documenting your own functions and making them as flexible as possible">
<title>Writing Flexible Functions in R – Mathematical Marine Ecology Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../img/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-a331e776612922e8a26c861783a558cd.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-815ee49807f6a3133bf74f4630faa741.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="../../styles.css">
</head>
<body class="nav-fixed quarto-dark"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = true;
    const darkModeDefault = authorPrefersDark;
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../img/logo.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mathematical Marine Ecology Lab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../people/index.html"> 
<span class="menu-text">People</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../join/index.html"> 
<span class="menu-text">Why Join?</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../future/index.html"> 
<span class="menu-text">Available Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../education.html"> 
<span class="menu-text">Education</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications/index.html"> 
<span class="menu-text">Lab Publications</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="mailto:a.richardson1@uq.edu.au"> <i class="bi bi-envelope" role="img" aria-label="email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MathMarEcol"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Writing Flexible Functions in R</h1>
                  <div>
        <div class="description">
          This tutorial will cover the basics of function structure, writing and documenting your own functions and making them as flexible as possible
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">academia</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">programming</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jason Everett </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 25, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li><a href="#why-we-use-functions-in-r" id="toc-why-we-use-functions-in-r" class="nav-link active" data-scroll-target="#why-we-use-functions-in-r"><span class="header-section-number">1</span> Why We Use Functions in R</a></li>
  <li><a href="#what-the-basic-structure-of-a-function-looks-like" id="toc-what-the-basic-structure-of-a-function-looks-like" class="nav-link" data-scroll-target="#what-the-basic-structure-of-a-function-looks-like"><span class="header-section-number">2</span> What the Basic Structure of a Function Looks Like</a></li>
  <li><a href="#writing-a-basic-function-to-show-the-structure" id="toc-writing-a-basic-function-to-show-the-structure" class="nav-link" data-scroll-target="#writing-a-basic-function-to-show-the-structure"><span class="header-section-number">3</span> Writing a Basic Function to Show the Structure</a></li>
  <li><a href="#writing-a-more-complex-function-that-plots-data" id="toc-writing-a-more-complex-function-that-plots-data" class="nav-link" data-scroll-target="#writing-a-more-complex-function-that-plots-data"><span class="header-section-number">4</span> Writing a More Complex Function That Plots Data</a></li>
  <li><a href="#working-with-column-names-as-strings--" id="toc-working-with-column-names-as-strings--" class="nav-link" data-scroll-target="#working-with-column-names-as-strings--"><span class="header-section-number">5</span> Working with Column Names as Strings - <code>[[]]</code></a></li>
  <li>
<a href="#what-is-tidy-evaluation" id="toc-what-is-tidy-evaluation" class="nav-link" data-scroll-target="#what-is-tidy-evaluation"><span class="header-section-number">6</span> What is Tidy Evaluation?</a>
  <ul class="collapse">
<li><a href="#the-problem-functions-dont-work-with-dplyr" id="toc-the-problem-functions-dont-work-with-dplyr" class="nav-link" data-scroll-target="#the-problem-functions-dont-work-with-dplyr"><span class="header-section-number">6.1</span> The Problem: Functions Don’t Work with dplyr</a></li>
  </ul>
</li>
  <li><a href="#data-masking" id="toc-data-masking" class="nav-link" data-scroll-target="#data-masking"><span class="header-section-number">7</span> Data Masking</a></li>
  <li>
<a href="#the-curly-curly-operator" id="toc-the-curly-curly-operator" class="nav-link" data-scroll-target="#the-curly-curly-operator"><span class="header-section-number">8</span> The Curly-Curly Operator <code>{{}}</code></a>
  <ul class="collapse">
<li><a href="#using-with-ggplot2" id="toc-using-with-ggplot2" class="nav-link" data-scroll-target="#using-with-ggplot2"><span class="header-section-number">8.1</span> Using <code>{{}}</code> with ggplot2</a></li>
  </ul>
</li>
  <li>
<a href="#using-...-for-ultimate-flexibility" id="toc-using-...-for-ultimate-flexibility" class="nav-link" data-scroll-target="#using-...-for-ultimate-flexibility"><span class="header-section-number">9</span> Using <code>...</code> for Ultimate Flexibility</a>
  <ul class="collapse">
<li><a href="#example-1-passing-arguments-to-ggplot2" id="toc-example-1-passing-arguments-to-ggplot2" class="nav-link" data-scroll-target="#example-1-passing-arguments-to-ggplot2"><span class="header-section-number">9.1</span> Example 1: Passing Arguments to ggplot2</a></li>
  <li><a href="#example-2-flexible-summary-function" id="toc-example-2-flexible-summary-function" class="nav-link" data-scroll-target="#example-2-flexible-summary-function"><span class="header-section-number">9.2</span> Example 2: Flexible Summary Function</a></li>
  <li><a href="#example-3-combining-and-..." id="toc-example-3-combining-and-..." class="nav-link" data-scroll-target="#example-3-combining-and-..."><span class="header-section-number">9.3</span> Example 3: Combining <code>{{}}</code> and <code>...</code></a></li>
  </ul>
</li>
  <li>
<a href="#documenting-your-functions" id="toc-documenting-your-functions" class="nav-link" data-scroll-target="#documenting-your-functions"><span class="header-section-number">10</span> Documenting Your Functions</a>
  <ul class="collapse">
<li><a href="#common-roxygen2-tags" id="toc-common-roxygen2-tags" class="nav-link" data-scroll-target="#common-roxygen2-tags"><span class="header-section-number">10.1</span> Common roxygen2 Tags</a></li>
  </ul>
</li>
  <li>
<a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">11</span> Summary</a>
  <ul class="collapse">
<li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways"><span class="header-section-number">11.1</span> Key Takeaways</a></li>
  <li><a href="#practice-exercises" id="toc-practice-exercises" class="nav-link" data-scroll-target="#practice-exercises"><span class="header-section-number">11.2</span> Practice Exercises</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content"><section id="why-we-use-functions-in-r" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Why We Use Functions in R</h1>
<p>For this session we are going to use the <a href="https://www.gapminder.org/"><code>gapminder</code></a> dataset.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About the Gapminder Dataset
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <a href="https://www.gapminder.org/"><code>gapminder</code></a> dataset contains information about life expectancy, population, and GDP per capita for countries around the world from 1952 to 2007. This dataset was made famous by Hans Rosling, a Swedish physician and statistician who used it in his captivating TED talks to challenge misconceptions about global development. Rosling’s animated visualisations of this data revealed surprising trends about how countries have progressed over time, showing that the world has become healthier and wealthier than many people realise.</p>
<p>The dataset is perfect for demonstrating data analysis techniques because it contains both categorical variables (country, continent) and numerical variables (year, life expectancy, population, GDP per capita), with enough complexity to showcase real-world data challenges while remaining manageable for learning purposes.</p>
</div>
</div>
<p>Before we start, let’s load the packages we’ll need:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Functions are the building blocks of reproducible analysis in R. They:</p>
<ul>
<li>Help you avoid repeating yourself (DRY principle)</li>
<li>Make your code easier to read, test, and debug</li>
<li>Allow you to generalise analyses to any dataset</li>
<li>Enable collaboration and sharing of code</li>
</ul>
<p>Today, we’ll learn how to write flexible functions that work with any data, and how to document them for others to use.</p>
</section><section id="what-the-basic-structure-of-a-function-looks-like" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> What the Basic Structure of a Function Looks Like</h1>
<p>Here is the basic structure of a function in R:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function name assignment</span></span>
<span><span class="va">my_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">arg1</span>, <span class="va">arg2</span><span class="op">)</span> <span class="op">{</span>  <span class="co"># Arguments (parameters)</span></span>
<span>  <span class="co"># Function body - the code that does the work</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">arg1</span> <span class="op">+</span> <span class="va">arg2</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>  <span class="co"># Return value (optional)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s break down the key components:</p>
<ul>
<li>
<strong>Function name</strong>: <code>my_function</code> - what you’ll call to use the function</li>
<li>
<strong>Assignment operator</strong>: <code>&lt;-</code> - assigns the function to a name</li>
<li>
<strong><code>function()</code> keyword</strong>: tells R you’re creating a function</li>
<li>
<strong>Arguments</strong>: <code>arg1, arg2</code> - the inputs your function accepts</li>
<li>
<strong>Function body</strong>: the code between <code><a href="https://rdrr.io/r/base/Paren.html">{}</a></code> that does the actual work</li>
<li>
<strong>Return value</strong>: what the function gives back (optional - R returns the last evaluated expression by default)</li>
</ul>
<p>Here’s a simple working example:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># A function to calculate the area of a rectangle</span></span>
<span><span class="va">calculate_area</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">length</span>, <span class="va">width</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">area</span> <span class="op">&lt;-</span> <span class="va">length</span> <span class="op">*</span> <span class="va">width</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test our function</span></span>
<span><span class="fu">calculate_area</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15</code></pre>
</div>
</div>
</section><section id="writing-a-basic-function-to-show-the-structure" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> Writing a Basic Function to Show the Structure</h1>
<p>Let’s write a function that filters the <code>gapminder</code> dataset for countries with life expectancy above a given threshold. We’ll keep it simple and use a fixed column name:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filter_lifeExp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">threshold</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="va">threshold</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example usage</span></span>
<span><span class="fu">filter_lifeExp</span><span class="op">(</span><span class="va">gapminder</span>, <span class="fl">60</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
   country continent  year lifeExp     pop gdpPercap
   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;
 1 Albania Europe     1962    64.8 1728137     2313.
 2 Albania Europe     1967    66.2 1984060     2760.
 3 Albania Europe     1972    67.7 2263554     3313.
 4 Albania Europe     1977    68.9 2509048     3533.
 5 Albania Europe     1982    70.4 2780097     3631.
 6 Albania Europe     1987    72   3075321     3739.
 7 Albania Europe     1992    71.6 3326498     2497.
 8 Albania Europe     1997    73.0 3428038     3193.
 9 Albania Europe     2002    75.7 3508512     4604.
10 Albania Europe     2007    76.4 3600523     5937.</code></pre>
</div>
</div>
</section><section id="writing-a-more-complex-function-that-plots-data" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> Writing a More Complex Function That Plots Data</h1>
<p>Now let’s write a plotting function for the same data:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">my_scatter_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"blue"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example usage</span></span>
<span><span class="va">filtered</span> <span class="op">&lt;-</span> <span class="fu">filter_lifeExp</span><span class="op">(</span><span class="va">gapminder</span>, <span class="fl">60</span><span class="op">)</span></span>
<span><span class="fu">my_scatter_plot</span><span class="op">(</span><span class="va">filtered</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Try changing the threshold in <code>filter_lifeExp()</code> to see how the plot changes.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The Limitation of Fixed Column Names
</div>
</div>
<div class="callout-body-container callout-body">
<p>But what if we wanted more flexible functions that can take many different column names? Or even work with a completely different dataset with different column names?</p>
<p>Our current functions are quite rigid - they only work with specific column names like <code>lifeExp</code> and <code>gdpPercap</code>. This limits their reusability!</p>
</div>
</div>
</section><section id="working-with-column-names-as-strings--" class="level1" data-number="5"><h1 data-number="5">
<span class="header-section-number">5</span> Working with Column Names as Strings - <code>[[]]</code>
</h1>
<p>Before we dive into tidy evaluation, let’s look at some common scenarios. Normally, we make an explicit choice about which column we want to access in our data.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">60</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># or .data$lifeExp</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
   country continent  year lifeExp     pop gdpPercap
   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;
 1 Albania Europe     1962    64.8 1728137     2313.
 2 Albania Europe     1967    66.2 1984060     2760.
 3 Albania Europe     1972    67.7 2263554     3313.
 4 Albania Europe     1977    68.9 2509048     3533.
 5 Albania Europe     1982    70.4 2780097     3631.
 6 Albania Europe     1987    72   3075321     3739.
 7 Albania Europe     1992    71.6 3326498     2497.
 8 Albania Europe     1997    73.0 3428038     3193.
 9 Albania Europe     2002    75.7 3508512     4604.
10 Albania Europe     2007    76.4 3600523     5937.</code></pre>
</div>
</div>
<p>What if you wanted to change that column programmatically and not update your code every time? First, let’s assume your column name is stored as a string.</p>
<p>The <code>[[]]</code> operator with <code>.data</code> <strong>directly looks up</strong> a column by its string name. Think of it as saying “go find the column with this exact name and give me its values.” It bypasses all the fancy tidy evaluation and just does a straightforward column lookup.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Using [[]] with .data for explicit column access</span></span>
<span><span class="va">column_name</span> <span class="op">&lt;-</span> <span class="st">"lifeExp"</span></span>
<span></span>
<span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">column_name</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">60</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
   country continent  year lifeExp     pop gdpPercap
   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;
 1 Albania Europe     1962    64.8 1728137     2313.
 2 Albania Europe     1967    66.2 1984060     2760.
 3 Albania Europe     1972    67.7 2263554     3313.
 4 Albania Europe     1977    68.9 2509048     3533.
 5 Albania Europe     1982    70.4 2780097     3631.
 6 Albania Europe     1987    72   3075321     3739.
 7 Albania Europe     1992    71.6 3326498     2497.
 8 Albania Europe     1997    73.0 3428038     3193.
 9 Albania Europe     2002    75.7 3508512     4604.
10 Albania Europe     2007    76.4 3600523     5937.</code></pre>
</div>
</div>
<p>This is particularly useful in functions where you might receive column names as strings:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function that takes a column name as a string</span></span>
<span><span class="va">filter_by_string_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">col_name_string</span>, <span class="va">threshold</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">col_name_string</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">threshold</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test with column name as string</span></span>
<span><span class="fu">filter_by_string_name</span><span class="op">(</span><span class="va">gapminder</span>, <span class="st">"gdpPercap"</span>, <span class="fl">30000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
   country   continent  year lifeExp      pop gdpPercap
   &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
 1 Australia Oceania    2002    80.4 19546792    30688.
 2 Australia Oceania    2007    81.2 20434176    34435.
 3 Austria   Europe     2002    79.0  8148312    32418.
 4 Austria   Europe     2007    79.8  8199783    36126.
 5 Belgium   Europe     2002    78.3 10311970    30486.
 6 Belgium   Europe     2007    79.4 10392226    33693.
 7 Canada    Americas   2002    79.8 31902268    33329.
 8 Canada    Americas   2007    80.7 33390141    36319.
 9 Denmark   Europe     2002    77.2  5374693    32167.
10 Denmark   Europe     2007    78.3  5468120    35278.</code></pre>
</div>
</div>
<p>Equally, it works with ggplot2, which is quite helpful because you often want to write generic plotting functions for multiple variables.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to create a simple scatter plot</span></span>
<span><span class="va">my_scatter_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">x_column</span><span class="op">]</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">y_column</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">filter_by_string_name</span><span class="op">(</span><span class="va">gapminder</span>, <span class="st">"gdpPercap"</span>, <span class="fl">30000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a plot</span></span>
<span><span class="fu">my_scatter_plot</span><span class="op">(</span><span class="va">dat</span>, <span class="st">"gdpPercap"</span>, <span class="st">"lifeExp"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Try one of the other numeric variables, or reverse <code>x_column</code> and <code>y_column</code>.</p>
<p>Did you know that piping works with your own functions too?</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">filter_by_string_name</span><span class="op">(</span><span class="st">"gdpPercap"</span>, <span class="fl">30000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">my_scatter_plot</span><span class="op">(</span><span class="st">"gdpPercap"</span>, <span class="st">"lifeExp"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The <code>[[]]</code> approach works, but…
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>[[]]</code> syntax with <code>.data</code> is explicit column access - you’re directly looking up columns by their string names. This works well when:</p>
<ul>
<li>You have column names as strings</li>
<li>You want to be very explicit about data access</li>
<li>You’re building functions that work with string-based specifications</li>
</ul>
<p><strong>But what if users want to pass unquoted column names</strong> like <code>filter_function(data, lifeExp, 75)</code> instead of <code>filter_function(data, "lifeExp", 75)</code>?</p>
<p>That’s where tidy evaluation comes in…</p>
</div>
</div>
</section><section id="what-is-tidy-evaluation" class="level1" data-number="6"><h1 data-number="6">
<span class="header-section-number">6</span> What is Tidy Evaluation?</h1>
<p><strong>Tidy evaluation</strong> is the system that allows tidyverse functions to work with unquoted column names. It’s what makes this possible:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># This works - no quotes around column names despite `year` not being in your environment!</span></span>
<span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">continent</span>, <span class="va">lifeExp</span>, <span class="va">gdpPercap</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 142 × 4
   country     continent lifeExp gdpPercap
   &lt;fct&gt;       &lt;fct&gt;       &lt;dbl&gt;     &lt;dbl&gt;
 1 Afghanistan Asia         43.8      975.
 2 Albania     Europe       76.4     5937.
 3 Algeria     Africa       72.3     6223.
 4 Angola      Africa       42.7     4797.
 5 Argentina   Americas     75.3    12779.
 6 Australia   Oceania      81.2    34435.
 7 Austria     Europe       79.8    36126.
 8 Bahrain     Asia         75.6    29796.
 9 Bangladesh  Asia         64.1     1391.
10 Belgium     Europe       79.4    33693.
# ℹ 132 more rows</code></pre>
</div>
</div>
<section id="the-problem-functions-dont-work-with-dplyr" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="the-problem-functions-dont-work-with-dplyr">
<span class="header-section-number">6.1</span> The Problem: Functions Don’t Work with dplyr</h2>
<p>The challenge comes when you try to write your own functions. Let’s see what happens:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># This function won't work as expected</span></span>
<span><span class="va">my_filter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">column_name</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">column_name</span> <span class="op">==</span> <span class="va">value</span><span class="op">)</span>  <span class="co"># This doesn't work!</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Try to use it</span></span>
<span><span class="fu">my_filter</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">year</span>, <span class="fl">2007</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `filter()`:
ℹ In argument: `column_name == value`.
Caused by error in `column_name == value`:
! comparison (==) is possible only for atomic and list types</code></pre>
</div>
</div>
<p>The function fails because <code>column_name</code> is treated as the literal text “column_name”, not as the variable name we passed in (<code>year</code>). This is where tidy evaluation and data masking comes to the rescue!</p>
</section></section><section id="data-masking" class="level1" data-number="7"><h1 data-number="7">
<span class="header-section-number">7</span> Data Masking</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What is Data Masking?
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Data masking</strong> makes column names in your data frame available as if they were regular variables. It is what allows you to write <code>filter(gapminder, year == 2007)</code> instead of <code>filter(gapminder, gapminder$year == 2007)</code>. The column name <code>year</code> gets “masked” so it appears to exist in your current environment.</p>
<p>This is why you can write:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># This works - year refers to the column</span></span>
<span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 142 × 6
   country     continent  year lifeExp       pop gdpPercap
   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
 1 Afghanistan Asia       2007    43.8  31889923      975.
 2 Albania     Europe     2007    76.4   3600523     5937.
 3 Algeria     Africa     2007    72.3  33333216     6223.
 4 Angola      Africa     2007    42.7  12420476     4797.
 5 Argentina   Americas   2007    75.3  40301927    12779.
 6 Australia   Oceania    2007    81.2  20434176    34435.
 7 Austria     Europe     2007    79.8   8199783    36126.
 8 Bahrain     Asia       2007    75.6    708573    29796.
 9 Bangladesh  Asia       2007    64.1 150448339     1391.
10 Belgium     Europe     2007    79.4  10392226    33693.
# ℹ 132 more rows</code></pre>
</div>
</div>
<p>You’ve been using data masking every time you use dplyr functions - you just didn’t know it had a name!</p>
</div>
</div>
</section><section id="the-curly-curly-operator" class="level1" data-number="8"><h1 data-number="8">
<span class="header-section-number">8</span> The Curly-Curly Operator <code>{{}}</code>
</h1>
<p>The <strong>curly-curly</strong> operator <code>{{}}</code> is the solution to our function problem!</p>
<p>Conceptually, <code>{{}}</code> <strong>captures and forwards</strong> whatever the user passed to your function. Think of it as a “pass-through” mechanism - it takes the unquoted column name the user gave you (like <code>lifeExp</code>) and forwards it to dplyr functions as if you had typed that column name directly in the code.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What does <code>{{}}</code> do?
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>{{}}</code> operator (called “curly-curly”) is like a magic wrapper that:</p>
<ol type="1">
<li>
<strong>Captures</strong> the column name you pass to your function</li>
<li>
<strong>Passes it through</strong> to dplyr functions correctly</li>
<li>
<strong>Makes it work</strong> just like typing the column name directly</li>
</ol>
<p>Think of <code>{column_name}</code> as saying “use whatever column name the user gave me here.”</p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fixed version using curly-curly</span></span>
<span><span class="va">my_filter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">column_name</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">column_name</span><span class="op">}</span><span class="op">}</span> <span class="op">==</span> <span class="va">value</span><span class="op">)</span>  <span class="co"># {{}} makes this work!</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Now it works!</span></span>
<span><span class="fu">my_filter</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">year</span>, <span class="fl">2007</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
   country     continent  year lifeExp       pop gdpPercap
   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
 1 Afghanistan Asia       2007    43.8  31889923      975.
 2 Albania     Europe     2007    76.4   3600523     5937.
 3 Algeria     Africa     2007    72.3  33333216     6223.
 4 Angola      Africa     2007    42.7  12420476     4797.
 5 Argentina   Americas   2007    75.3  40301927    12779.
 6 Australia   Oceania    2007    81.2  20434176    34435.
 7 Austria     Europe     2007    79.8   8199783    36126.
 8 Bahrain     Asia       2007    75.6    708573    29796.
 9 Bangladesh  Asia       2007    64.1 150448339     1391.
10 Belgium     Europe     2007    79.4  10392226    33693.</code></pre>
</div>
</div>
<p>Let’s try a few more simple examples:</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to select and arrange data</span></span>
<span><span class="va">my_select_arrange</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">column_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span>, <span class="op">{</span><span class="op">{</span><span class="va">column_name</span><span class="op">}</span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">column_name</span><span class="op">}</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test it out</span></span>
<span><span class="fu">my_select_arrange</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">lifeExp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   country       year lifeExp
   &lt;fct&gt;        &lt;int&gt;   &lt;dbl&gt;
 1 Rwanda        1992    23.6
 2 Afghanistan   1952    28.8
 3 Gambia        1952    30  
 4 Angola        1952    30.0
 5 Sierra Leone  1952    30.3
 6 Afghanistan   1957    30.3
 7 Cambodia      1977    31.2
 8 Mozambique    1952    31.3
 9 Sierra Leone  1957    31.6
10 Burkina Faso  1952    32.0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to create a simple summary</span></span>
<span><span class="va">my_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">group_column</span>, <span class="va">summary_column</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">group_column</span><span class="op">}</span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>      average <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">summary_column</span><span class="op">}</span><span class="op">}</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test with different combinations</span></span>
<span><span class="fu">my_summary</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">continent</span>, <span class="va">lifeExp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  continent average count
  &lt;fct&gt;       &lt;dbl&gt; &lt;int&gt;
1 Africa       48.9   624
2 Americas     64.7   300
3 Asia         60.1   396
4 Europe       71.9   360
5 Oceania      74.3    24</code></pre>
</div>
</div>
<section id="using-with-ggplot2" class="level2" data-number="8.1"><h2 data-number="8.1" class="anchored" data-anchor-id="using-with-ggplot2">
<span class="header-section-number">8.1</span> Using <code>{{}}</code> with ggplot2</h2>
<p>The curly-curly operator also works with ggplot2:</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to create a simple scatter plot</span></span>
<span><span class="va">my_scatter_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">{</span><span class="op">{</span><span class="va">x_column</span><span class="op">}</span><span class="op">}</span>, y <span class="op">=</span> <span class="op">{</span><span class="op">{</span><span class="va">y_column</span><span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create a plot</span></span>
<span><span class="fu">my_scatter_plot</span><span class="op">(</span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span>, <span class="va">gdpPercap</span>, <span class="va">lifeExp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key Point: <code>{{}}</code> works everywhere
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>{{}}</code> operator works with:</p>
<ul>
<li>
<strong>dplyr functions</strong>: <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, etc.</li>
<li>
<strong>ggplot2</strong>: inside <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> for aesthetics</li>
<li>
<strong>Any tidyverse function</strong> that uses tidy evaluation This consistency makes it easy to remember - just wrap your column arguments in <code>{{}}</code> and they’ll work!</li>
</ul>
</div>
</div>
</section></section><section id="using-...-for-ultimate-flexibility" class="level1" data-number="9"><h1 data-number="9">
<span class="header-section-number">9</span> Using <code>...</code> for Ultimate Flexibility</h1>
<p>The <strong>dot-dot-dot</strong> (<code>...</code>) parameter is another powerful tool for creating flexible functions. It allows your function to accept any number of additional arguments and pass them along to other functions.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What does <code>...</code> do?
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>...</code> parameter (called “dot-dot-dot” or “ellipsis”) allows your function to:</p>
<ol type="1">
<li>
<strong>Accept unlimited arguments</strong> that you don’t need to specify in advance</li>
<li>
<strong>Pass arguments through</strong> to other functions without knowing what they are</li>
<li>
<strong>Make wrapper functions</strong> that extend existing functionality</li>
</ol>
<p>Think of <code>...</code> as saying “accept whatever else the user wants to pass along.”</p>
</div>
</div>
<section id="example-1-passing-arguments-to-ggplot2" class="level2" data-number="9.1"><h2 data-number="9.1" class="anchored" data-anchor-id="example-1-passing-arguments-to-ggplot2">
<span class="header-section-number">9.1</span> Example 1: Passing Arguments to ggplot2</h2>
<p>Let’s create a plotting function that can accept any additional ggplot2 arguments:</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function that accepts additional ggplot arguments via ...</span></span>
<span><span class="va">flexible_scatter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">x_col</span>, <span class="va">y_col</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">{</span><span class="op">{</span><span class="va">x_col</span><span class="op">}</span><span class="op">}</span>, y <span class="op">=</span> <span class="op">{</span><span class="op">{</span><span class="va">y_col</span><span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Pass ... to geom_point()</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Now we can pass any geom_point() arguments</span></span>
<span><span class="fu">flexible_scatter</span><span class="op">(</span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span>,</span>
<span>                <span class="va">gdpPercap</span>, <span class="va">lifeExp</span>,</span>
<span>                colour <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="example-2-flexible-summary-function" class="level2" data-number="9.2"><h2 data-number="9.2" class="anchored" data-anchor-id="example-2-flexible-summary-function">
<span class="header-section-number">9.2</span> Example 2: Flexible Summary Function</h2>
<p>Here’s a summary function that can accept additional arguments for the summary functions:</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function that passes ... to summary functions</span></span>
<span><span class="va">flexible_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">group_col</span>, <span class="va">summary_col</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">group_col</span><span class="op">}</span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>      mean_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">summary_col</span><span class="op">}</span><span class="op">}</span>, <span class="va">...</span><span class="op">)</span>,  <span class="co"># Pass ... to mean()</span></span>
<span>      median_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">summary_col</span><span class="op">}</span><span class="op">}</span>, <span class="va">...</span><span class="op">)</span>,  <span class="co"># Pass ... to median()</span></span>
<span>      count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test with na.rm = TRUE passed through ...</span></span>
<span><span class="va">gapminder_with_na</span> <span class="op">&lt;-</span> <span class="va">gapminder</span></span>
<span><span class="va">gapminder_with_na</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>  <span class="co"># Add some missing values</span></span>
<span></span>
<span><span class="fu">flexible_summary</span><span class="op">(</span><span class="va">gapminder_with_na</span>, <span class="va">continent</span>, <span class="va">lifeExp</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  continent mean_val median_val count
  &lt;fct&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
1 Africa        48.9       47.8   624
2 Americas      64.7       67.0   300
3 Asia          60.4       62.0   396
4 Europe        71.9       72.2   360
5 Oceania       74.3       73.7    24</code></pre>
</div>
</div>
</section><section id="example-3-combining-and-..." class="level2" data-number="9.3"><h2 data-number="9.3" class="anchored" data-anchor-id="example-3-combining-and-...">
<span class="header-section-number">9.3</span> Example 3: Combining <code>{{}}</code> and <code>...</code>
</h2>
<p>You can use both <code>{{}}</code> and <code>...</code> in the same function for maximum flexibility:</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ultimate flexible plotting function</span></span>
<span><span class="va">ultimate_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">x_col</span>, <span class="va">y_col</span>, <span class="va">plot_type</span> <span class="op">=</span> <span class="st">"point"</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">{</span><span class="op">{</span><span class="va">x_col</span><span class="op">}</span><span class="op">}</span>, y <span class="op">=</span> <span class="op">{</span><span class="op">{</span><span class="va">y_col</span><span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">plot_type</span> <span class="op">==</span> <span class="st">"point"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">plot_type</span> <span class="op">==</span> <span class="st">"line"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Use with different geom arguments</span></span>
<span><span class="fu">ultimate_plot</span><span class="op">(</span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Australia"</span><span class="op">)</span>,</span>
<span>              <span class="va">year</span>, <span class="va">lifeExp</span>,</span>
<span>              plot_type <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>              colour <span class="op">=</span> <span class="st">"blue"</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
When to Use <code>...</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>...</code> when you want to:</p>
<ul>
<li>
<strong>Wrap existing functions</strong> and allow users to pass additional arguments</li>
<li>
<strong>Create flexible plotting functions</strong> that accept aesthetic parameters</li>
<li>
<strong>Build summary functions</strong> that can handle different options (like <code>na.rm</code>)</li>
<li>
<strong>Make your functions extensible</strong> without knowing all possible future arguments</li>
</ul>
<p><strong>Be careful</strong>: <code>...</code> can make debugging harder since you don’t know what arguments might be passed!</p>
</div>
</div>
</section></section><section id="documenting-your-functions" class="level1" data-number="10"><h1 data-number="10">
<span class="header-section-number">10</span> Documenting Your Functions</h1>
<p>Documenting your functions is essential for sharing and future use. Good documentation helps others (and future you!) understand:</p>
<ul>
<li>What the function does</li>
<li>What inputs it expects</li>
<li>What it returns</li>
<li>How to use it</li>
</ul>
<p>The standard in R is to use <strong>roxygen2</strong> comments above your function. These special comments start with <code>#'</code> and use specific tags:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Keyboard Shortcuts for Roxygen2
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>RStudio shortcuts for adding roxygen2 headers:</strong></p>
<ul>
<li>
<strong>Windows/Linux</strong>: <code>Ctrl + Alt + Shift + R</code>
</li>
<li>
<strong>Mac</strong>: <code>Cmd + Option + Shift + R</code>
</li>
</ul>
<p>Place your cursor anywhere inside your function and use this shortcut to automatically generate a roxygen2 template with all the <code>@param</code> tags for your function arguments!</p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' Filter a data frame by a column and threshold</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function filters a data frame to show only rows where the specified</span></span>
<span><span class="co">#' column values are above a given threshold, returning the top 3 results.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param data A data frame to filter</span></span>
<span><span class="co">#' @param column_name Column name as a string (e.g., "lifeExp")</span></span>
<span><span class="co">#' @param threshold Numeric threshold value for filtering</span></span>
<span><span class="co">#' @return A filtered data frame with up to 3 rows</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' filter_gapminder(gapminder, "lifeExp", 75)</span></span>
<span><span class="co">#' filter_gapminder(gapminder, "gdpPercap", 30000)</span></span>
<span><span class="va">filter_gapminder</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">column_name</span>, <span class="va">threshold</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">column_name</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">threshold</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="common-roxygen2-tags" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="common-roxygen2-tags">
<span class="header-section-number">10.1</span> Common roxygen2 Tags</h2>
<ul>
<li>
<code>@param</code>: Describes each parameter</li>
<li>
<code>@return</code>: Describes what the function returns</li>
<li>
<code>@examples</code>: Shows how to use the function</li>
</ul>
<p>Let’s document one of our curly-curly functions as well:</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' Create a summary by group</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function groups data by a specified column and calculates the mean</span></span>
<span><span class="co">#' and count for another column.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param data A data frame</span></span>
<span><span class="co">#' @param group_column Column to group by (unquoted)</span></span>
<span><span class="co">#' @param summary_column Column to summarise (unquoted)</span></span>
<span><span class="co">#' @return A data frame with group, average, and count columns</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' my_summary(gapminder, continent, lifeExp)</span></span>
<span><span class="co">#' my_summary(gapminder, year, gdpPercap)</span></span>
<span><span class="va">my_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">group_column</span>, <span class="va">summary_column</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">group_column</span><span class="op">}</span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>      average <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">summary_column</span><span class="op">}</span><span class="op">}</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Building Packages
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’re building an R package, you can use <a href="https://devtools.r-lib.org/"><code>devtools::document()</code></a> to automatically generate help files from your roxygen2 comments. This creates the standard R help documentation that users can access with <code>?function_name</code>.</p>
</div>
</div>
</section></section><section id="summary" class="level1" data-number="11"><h1 data-number="11">
<span class="header-section-number">11</span> Summary</h1>
<p>Today we’ve covered:</p>
<ol type="1">
<li>
<strong>Basic function structure</strong> - the essential components of any R function</li>
<li>
<strong>String-based column access</strong> - using <code>.data[[]]</code> for programmatic column selection</li>
<li>
<strong>Tidy evaluation</strong> - understanding how tidyverse functions work with unquoted names</li>
<li>
<strong>Data masking</strong> - the system that makes column names available as variables</li>
<li>
<strong>The curly-curly operator <code>{{}}</code></strong> - making your functions work seamlessly with tidyverse</li>
<li>
<strong>Documentation</strong> - using roxygen2 to create professional function documentation</li>
</ol>
<section id="key-takeaways" class="level2" data-number="11.1"><h2 data-number="11.1" class="anchored" data-anchor-id="key-takeaways">
<span class="header-section-number">11.1</span> Key Takeaways</h2>
<ul>
<li>Use <code>{{}}</code> when you want users to pass unquoted column names</li>
<li>Use <code>.data[[]]</code> when you have column names as strings</li>
<li>Always document your functions with roxygen2 comments</li>
<li>Test your functions with different datasets to ensure flexibility</li>
</ul></section><section id="practice-exercises" class="level2" data-number="11.2"><h2 data-number="11.2" class="anchored" data-anchor-id="practice-exercises">
<span class="header-section-number">11.2</span> Practice Exercises</h2>
<p>Try creating your own functions that:</p>
<ol type="1">
<li>Filter data based on multiple conditions using <code>{{}}</code>
</li>
<li>Create different types of plots with flexible aesthetics</li>
<li>Calculate custom summaries with grouping variables</li>
<li>Include proper roxygen2 documentation</li>
</ol>
<p>Remember: the best functions are flexible, well-documented, and solve real problems in your analysis workflow!</p>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block">© 2025 Mathematical Marine Ecology Laboratory, The University of Queensland</span></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><span class="faux-block"><a href="https://github.com/MathMarEcol/MathMarEcol.github.io">View source on GitHub</a></span></p>
</div>
  </div>
</footer>


</body></html>